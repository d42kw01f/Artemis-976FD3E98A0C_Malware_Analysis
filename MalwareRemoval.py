4.	# Autor: Dakshitha Perera
5.	# Data : 19/01/2021
6.	# Title : program to remove Malware Sample One.
7.	
8.	from winreg import *
9.	import sqlite3
import winreg
import os
import re
10.	
11.	def ChromeHistryDelete():
12.		username = os.getlogin()
13.	
14.		db = sqlite3.connect('c:\\Users\\{}\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\History'.format(username))
15.		c = db.cursor()
16.	
17.		URLPattern = re.compile(r"https?://([^/]+)/")
18.		domains = {}
19.	
20.		result = True
21.		id = 0
22.		while result:
23.		    result = False
24.		    ids = []
25.	
26.		    for row in c.execute('SELECT id, url, title FROM urls WHERE id > ? LIMIT 1000', (id,)):
27.		        result = True
28.		        match = URLPattern.search(row[1])
29.		        id = row[0]
30.	
31.		        if match:
32.		            domain = match.group(1)
33.		            domains[domain] = domains.get(domain, 0) + 1
34.		            # clean if this is true
35.		            if "adexchange" in domain:
36.		                ids.append((id,))
37.	
38.		    c.executemany('DELETE FROM urls WHERE id=?', ids)
39.		    db.commit()
40.	
41.		db.close()
42.	
43.	def ClearChromeCookies():
44.		username = os.getlogin()
45.	
46.		db = sqlite3.connect('c:\\Users\\{}\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Cookies'.format(username))
47.		c = db.cursor()
48.	
49.		result = True
50.		while result:
51.			result = False
52.			ids = []
53.	
54.			for row in c.execute('SELECT creation_utc, host_key, name FROM Cookies'):
55.				id = row[0]
56.				if row[1] == '.adexchange.com':
57.					ids.append((id, ))
58.			
59.			c.executemany('DELETE FROM Cookies WHERE creation_utc=?', ids)
60.			db.commit()
61.	
62.		db.close()
63.	
64.	def ClearChromeCache():
65.		username = os.getlogin()
66.	
67.		db = ('C:\\Users\\{}\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Cache'.format(username))
68.	
69.		for root, dirs, files in os.walk(db):
70.		    for filename in files:
71.		    	pattern = re.compile(r'^f.')
72.		    	matches = pattern.finditer(filename)
73.		    	for match in matches:
74.		    		os.remove('C:\\Users\\{}\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Cache\\{}'.format(username, filename))
75.		    		print("Deleting {}".format(filename))
76.	

77.	ChromeHistryDelete()
78.	ClearChromeCache()
79.	ClearChromeCache()